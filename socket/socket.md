# socket套接字简介

socket是计算机之间进行通信的一种约定或一种方式。通过 socket 这种约定，一台计算机可以接收其他计算机的数据，也可以向其他计算机发送数据。

在Linux系统中，网络连接也是一个文件，我们可以`socket()`函数创建一个网络连接，它返回一个文件描述符，之后可以通过文件操作函数传输数据。

> Windows下socket被当做一个网络连接来对待。

套接字有许多种，最常用的是**Internet套接字**。

# 1 socket分类

根据数据的传输方式，可以将Internet套接字分成两种类型：

## 1.1流格式套接字

流格式套接字（Stream Sockets）也叫“面向连接的套接字”，在代码中使用`SOCK_STREAM`表示。

流格式套接字是一种**可靠的、双向的**通信数据流，**数据可以准确无误地到达另一台计算机**，如果损坏或丢失，**可以重新发送**。

特点如下：

* 数据在传输过程中不会消失；

* 数据**按顺序传输**；

* 数据的发送和接收**不同步**。

流格式套接字使用**TCP协议（The Transmission Control Protocol，传输控制协议）**。TCP用来确保数据的正确性，**IP（Internet Protocol，网络协议）**用来控制数据如何从源头到达目的地，也就是常说的“路由”。

流格式套接字的内部有一个**缓冲区**，socket传输的数据将保存到这个缓冲区。接收端在收到数据后并不一定立即读取，只要数据不超过缓冲区的容量，接收端有可能在缓冲区被填满以后一次性地读取，也可能分成好几次读取。

浏览器所使用的http协议就基于面向连接的套接字。FTP也是。

## 1.2 数据报格式套接字

数据报格式套接字（Datagram Sockets）也叫“无连接的套接字”，在代码中使用`SOCK_DGRAM`表示。

计算机只管传输数据，不作数据校验，如果数据在传输中损坏，或者没有到达另一台计算机，是没有办法补救的。数据报套接字所做的校验工作少，所以在传输效率方面比流格式套接字要高。

特点如下：

* 强调快速传输而非传输顺序；

* 传输的数据可能丢失也可能损毁；

* 限制每次传输的数据大小；

* 数据的发送和接收是同步的。

数据报套接字也使用IP协议作路由，但是它不使用 TCP 协议，而是使用**UDP（User Datagram Protocol，用户数据报协议）**。

DNS、即时聊天工具使用UDP。

# 2 计算机网络模型

网络模型是用来进行数据封装的。

![](img/1-1Z1241445324H.jpg)

socket编程，是站在传输层的基础上，所以可以使用TCP/UDP协议，但是不能干「访问网页」这样的事情，因为访问网页所需要的http协议位于应用层。

两台计算机进行通信时，必须遵守以下原则：

1. 必须是同一层次进行通信。

2. 每一层的功能都必须相同，也就是拥有完全相同的网络模型。

3. 数据只能逐层传输，不能跃层。

4. 每一层可以使用下层提供的服务，并向上层提供服务。

# 3 IP、MAC和端口号

通过IP地址、MAC地址和端口号，可以在计算机网络中确定一台计算机。

## 3.1 IP地址

IP地址是Internet Protocol Address的缩写，译为“网际协议地址”。

一台计算机可以拥有一个独立的IP地址，一个局域网也可以拥有一个独立的IP地址（对外就好像只有一台计算机）。对于目前广泛使用IPv4地址，它的资源是非常有限的，一台计算机一个IP地址是不现实的，往往是一个局域网才拥有一个IP地址。数据包中已经附带了IP地址。

## 3.2 MAC地址

真正能唯一标识一台计算机的是MAC地址，每个网卡的MAC地址在全世界都是独一无二的。局域网中的路由器/交换机会记录每台计算机的 MAC 地址。

MAC 地址是Media Access Control Address的缩写，直译为“媒体访问控制地址”，也称为局域网地址（LAN Address），以太网地址（Ethernet Address）或物理地址（Physical Address）。

数据包中除了会附带对方的IP地址，还会附带对方的MAC地址，当数据包达到局域网以后，路由器/交换机会根据数据包中的MAC地址找到对应的计算机，然后把数据包转交给它，这样就完成了数据的传递。

## 3.3 端口号

一台计算机可以同时提供多种网络服务，例如Web服务（网站）、FTP服务（文件传输服务）、SMTP服务（邮箱服务）等。为了区分不同的网络程序，计算机会为每个网络程序分配一个独一无二的端口号（Port Number），例如，Web服务的端口号是80，FTP服务的端口号是21，SMTP服务的端口号是25。
