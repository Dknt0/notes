# 2023.5.11

注意：XTDrone 修改了 `gazebo_ros` 包的源码

---

# 2023.5.13

今天学习了 MAVROS 基本用法。启动文件运行 SITL、Gazebo 和 MAVROS，出现一系列话题和服务，通过调用这些服务获取传感器信息、控制无人机。

与 MAVSDK 的比较：

优点：无人机所有传感器信息、可使用功能都可以通过 ROS 获取，不用编写程序单独获取，省了很多事。

局限：调用 MAVROS 服务只返回调用结果，没有 errorcode，不能像 MAVSDK 那样定位错误。

---

# 2023.5.16

昨天开始编写基于 MAVROS 的控制器，将控制器封装成一个类，话题 Subscriber 作为成员，回调函数中将消息存到另一个成员变量。

* 问题：好像回调函数只能是静态成员函数，其中只能操作静态成员变量。

解决：类对象中 Subscriber 的回调函数可以写为匿名函数，这样可以用动态成员变量来保存消息，不会报错。

* 问题：MAVROS 中无法从外部控制模式切换回其他模式

解决：是我服务名写错了

-

目标：

1. 键盘控制  已实现

2. 基于 future 的悬停模式  已实现

能否在飞行时加入单位方向保持？不重要，以后再说

---

# 2023.5.18

VINS-Fusion 已完成，但效果并不好，应该尝试一下迷宫场景。

添加了图像显示，使用 `cv_bridge`将图像消息转化为 OpenCV 矩阵，并显示。我的 OpenCV 编译有问题，contrib 没编译成功。

下一步计划

基于 OpenCV 窗口的控制

二维SLAM，二维路径规划

三维视觉SLAM，三维路径规划

---

# 2023.5.20

设计并实现了无人机飞行 Behavior Tree。

接下来需要实现：

1. 视觉 SLAM 避障（有大问题）

2. 目标检测服务器（不难实现）

3. 视觉伺服精准降落（没用过，时间不够就算了吧）

问题：如何自动实现这些视觉模块的启动与关闭？既然用逻辑控制，就不能只是手动输命令运行他们

---

# 2023.5.21

任务：实现基于视觉的三维路径规划

三维路径规划好难，不太现实。RTAB-Map 可以用深度相机构建二维地图，Realsense 的深度图像可以转换为 laserscan，这样就可以尝试运行二维路径规划。但也存在无人机飞行过程姿态改变导致算法失效的可能性。

实现不了，就只能手动控制了。

先实写目标检测服务器吧。

---

# 2023.5.23

move_base goal 是通过 Action 实现的。需要开新线程。

PX4 SITL 提示错误 TM : Time jump detected. Resetting time synchroniser，导致 Failsafe，无法 takeoff。 可能是因为 Gazebo 帧率过低。

---

# 2023.5.24

视觉里程计的精度一言难尽，使用其他里程计实现。

从 Gazebo 获取了位姿真值，发布里程计信息，代替视觉里程计。使用 2D SLAM 代替 ego，效果不错。

同时可以运行 VSLAM，但只是展示效果，没有实际意义。

如果有时间，

1. 真实的地图场景，多一点花花草草，VIO 会更精确

2. 目标检测服务器

3. 精准降落
